machine:
  services:
    - docker

  environment:
    DOMAIN: htmlgraphic.com
    HOST: post-office
    LOG_TOKEN: $LOG_ENTRIES_TOKEN
    PASS: p@ssw0Rd
    USER: p08tf1X

dependencies:
  override:
    - docker info
    - docker build -t htmlgraphic/postfix:latest .

test:
  override:
    # stop MySQL from running on CircleCI
    - sudo service mysql stop

    # spin up containers simulating a PRODCUTION build
    - docker-compose -f docker-compose.yml up -d; sleep 20
    # test correct env conf
    - docker logs postfix | grep "$USER:$PASS"
    # test logentries sample key
    - docker logs postfix | grep "$LOG_ENTRIES_TOKEN"
